
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Pharmacy Inventory</title>
 <style>
    body {
      font-family: Arial, sans-serif;
      margin: 0;
      background: #ffffff;
      color: #333;
    }

    header {
      background:white;
      padding: 10px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      color: black;
    }

    header h1 {
      margin: 0;
      font-size: 1.5rem;
    }

    nav a {
      margin-left: 15px;
      text-decoration: none;
      color: black;
    }
  

    nav a.active {
      text-decoration: underline;
    }

    main {
      padding: 20px;
    }

    .list-section {
      background: white;
      padding: 20px;
      border-radius: 8px;
      position: relative;
    }

    .top-bar {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 15px;
    }

    .search-container {
    margin: 15px 0 25px;
  }

  .search-container input {
    width: 100%;
    max-width: 400px;
    padding: 10px 15px;
    border: 2px solid #1dc962;
    border-radius: 8px;
    font-size: 1rem;
    outline: none;
  }
    .add-btn {
      background: #1dc962;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 5px;
      cursor: pointer;
    }
    .search-btn{
      background: #1dc962;
      color: white;
      border: none;
      padding: 8px 14px;
      border-radius: 5px;
      cursor: pointer;
    }

    .add-btn:hover {
      background: #17a652;
    }

    table {
      /* width: 100%;
      border-collapse: collapse;
      border: 1px solid #ddd;
      border-radius: 10px; */
      width: 100%;
    border: 1px solid #57ff92;
    border-radius: 12px;
    border-collapse: separate;
    border-spacing: 0;
    overflow: hidden;
    background-color: #fff;
    }

    table th, table td {
      padding: 10px;
     
      border: 1px solid #57ff92;
  
    border-collapse: separate;
   
    }

    table th {
      background: #c7ffb4;
    }

    /* Floating form modal */
    .modal {
      display: none; 
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.4);
      justify-content: center;
      align-items: center;
    }

    .modal-content {
      background: white;
      padding: 20px;
      border-radius: 8px;
      width: 500px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.2);
    }

    .modal-content h2 {
      margin-top: 0;
    }

    .modal-content input, 
    .modal-content button {
      width: 100%;
      margin: 10px 0;
      padding: 8px;
    }

    .close-btn {
        color: black;
      background: none;
      border: none; 
      text-align: end;  
right: 10px;
top: 5px;
      padding: 6px 10px;
      border-radius: 5px;
      float: right;
      cursor: pointer;
    }

    #message {
      margin-top: 10px;
    }
 </style>
</head>
<body>
 
   <header>
    <div class="logo-section">
      <h1>GramCare</h1>
    </div>
    <nav>
      <a href="homepage.html">Dashboard</a>
      <a href="#">Orders</a>
      <a href="pharm_inventory.html">Inventory</a>
      <!-- <a href="#">Patients</a>
      <a href="#">Reports</a> -->
    </nav>
    <div class="header-right">
      <button>ðŸ””</button>
      <div class="profile-pic" id="profile-pic"></div>
    </div>
  </header>

  <main>
    <section class="list-section">
      <div class="top-bar">
        <h2>Inventory List</h2>
        <button class="add-btn" id="openFormBtn">+ Add Stock</button>
      </div>
      <div class="search-container">
    <input type="text" id="searchInput" placeholder="Search medicines...">
    <button class="search-btn">Search</button>
  </div>
      <table>
        <thead>
          <tr>
            <th>Item Name</th>
            <th>Category</th>
            <th>Quantity</th>
            <th>Restock Date</th>
          </tr>
        </thead>
        <tbody id="inventoryTable"></tbody>
      </table>
    </section>
  </main>

  <!-- Modal Form -->
  <div class="modal" id="modalForm">
    <div class="modal-content">
      <button class="close-btn" id="closeFormBtn">X</button>
      <h2>Add Stock</h2>
      <form id="inventoryForm">
        <input type="text" id="itemName" placeholder="Item Name" required>
        <input type="text" id="category" placeholder="Category" required>
        <input type="number" id="quantity" placeholder="Quantity" required>
        <input type="date" id="restockDate" required>
        <button type="submit">Add Stock</button>
      </form>
      <p id="message"></p>
    </div>
  </div>

  <script>
    const form = document.getElementById('inventoryForm');
    const tableBody = document.getElementById('inventoryTable');
    const message = document.getElementById('message');
    const modal = document.getElementById('modalForm');
    const openBtn = document.getElementById('openFormBtn');
    const closeBtn = document.getElementById('closeFormBtn');

    // Show modal
    openBtn.addEventListener('click', () => modal.style.display = 'flex');
    // Hide modal
    closeBtn.addEventListener('click', () => modal.style.display = 'none');
    // Hide modal when clicking outside content
    window.addEventListener('click', (e) => {
      if (e.target === modal) modal.style.display = 'none';
    });

    // Get logged-in user email
    const userEmail = localStorage.getItem('userEmail');
    if (!userEmail) {
      window.location.href = "login.html"; 
    }

    // Fetch inventory
    async function loadInventory() {
      const res = await fetch(`http://localhost:4000/api/inventory?email=${userEmail}`);
      const data = await res.json();
      tableBody.innerHTML = "";
      data.forEach(item => {
        const row = `<tr>
          <td>${item.itemName}</td>
          <td>${item.category}</td>
          <td>${item.quantity}</td>
          <td>${item.restockDate}</td>
        </tr>`;
        tableBody.innerHTML += row;
      });
    }
    loadInventory();

    // Add stock
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const itemName = document.getElementById('itemName').value;
      const category = document.getElementById('category').value;
      const quantity = document.getElementById('quantity').value;
      const restockDate = document.getElementById('restockDate').value;

      const res = await fetch('http://localhost:4000/api/inventory', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ email: userEmail, itemName, category, quantity, restockDate })
      });

      const result = await res.json();
      if (res.status === 201) {
        message.textContent = "Stock added successfully!";
        message.style.color = "green";
        form.reset();
        loadInventory();
        setTimeout(() => { modal.style.display = 'none'; message.textContent = ""; }, 1000);
      } else {
        message.textContent = result.message;
        message.style.color = "red";
      }
    });
  </script>
</body>
</html>
